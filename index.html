<!DOCTYPE html>

<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Web Observatory API Tutorial</title>
    <script type="text/javascript" charset="utf-8" src="js/jquery-1.10.2.min.js"></script>
    <script type="text/javascript" charset="utf-8">
        $(function()
        {
            var setting = {
                clientId: "53cd0826eaba57bd64ffa6fb", //YOUR_CLINET_ID
                query:
                {
                    modname: "users",
                    query: "{}",
                    limit: "2"
                },
                dataset: "5486f32329d80b4428253250" //dataset id of interest
            };

            var host = "webobservatory.soton.ac.uk",
                woHost = "https://" + host,
                resourceHost = "https://" + host + "/api/wo/",
                endUserAuthorizationEndpoint = woHost + "/oauth/authorise";

            //helper function to extract the Access Token
            var extractToken = function(hash)
            {
                var match = hash.match(/access_token=((%|\w)+)/);
                return !!match && decodeURIComponent(match[1]);
            };

            var token = extractToken(document.location.hash);
            if (token)
            {
                $('div.authenticated').show();
                $('span.token').text(token);
                $.ajax(
                {
                    type: 'get',
                    url: resourceHost + setting.dataset + '/endpoint',
                    data: setting.query,
                    headers:
                    {
                        Authorization: 'Bearer ' + token
                    }
                }).done(function(response)
                {
                    var container = $('span.user');
                    if (response)
                    {
                        console.log(response);
                        container.text(response);
                    }
                    else
                    {
                        container.text("An error occurred.");
                    }
                });
            }
            else
            {
                $('div.authenticate').show();

                var authUrl = endUserAuthorizationEndpoint +
                    "?response_type=token" +
                    "&client_id=" + setting.clientId +
                    "&redirect_uri=" + window.location;

                $("a.connect").attr("href", authUrl);
            }
        });
    </script>
    <style>
        .hidden {
            display: none;
        }
    </style>
</head>

<body>
    <div class="authenticate hidden">
        <a class="connect" href="">Connect</a>
    </div>

    <div class="authenticated hidden">
        <p>
            You are using token
            <span class="token">[no token]</span>.
        </p>

        <p>
            Your resutl:
            <span class="user">[no username]</span>.
        </p>
    </div>
</body>

</html>
